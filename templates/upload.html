<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <title>ğŸ’™ æ¯›å­©äº¤å‹åŸºåœ° - ä¸Šå‚³æ¯›å­©èˆ‡åœ°é» ğŸ¾</title>
    <meta content="æ¯›å­©ç¤¾äº¤åœ°åœ–è¼”åŠ©é é¢" name="description">

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet"> 	
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <style>
        /* ğŸ¨ å…¨åŸŸ/è®Šæ•¸å®šç¾© - å†·è‰²ç³» (è—è‰²ä¸»é¡Œ) */
        :root {
            --primary-color: #00A8E8; /* æ¹–æ°´è—/å¯¶çŸ³è— - ä¸»è¦å¼·èª¿è‰² */
            --secondary-color: #00C9A7; /* è–„è·ç¶  - æ¬¡è¦å¼·èª¿è‰²/Iconè‰² */
            --bg-light: #E3F2FD; /* æ¥µæ·ºå¤©ç©ºè— - å…¨åŸŸèƒŒæ™¯ */
            --form-bg: #FFFFFF;
            --section-bg: #F4FBFF; /* æ·ºç°è—/é›ªç™½ç”¨æ–¼å€å¡ŠèƒŒæ™¯ */
            /* æ——å¹Ÿé¡è‰²è®Šæ•¸ */
            --banner-main: #00A8E8; 
            --banner-sub-text-color: #12638F; 
            --text-light: #FFFFFF;
            --text-dark: #34495e;
            /* åƒè€ƒåœ–ä¸­çš„é¡å¤–é¡è‰² */
            --border-green: #2ecc71; 
            --button-border-green: #27ae60; 
        }

        /* ğŸ–‹ï¸ å­—é«”è¨­å®š */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-light); 
        }
        h1, h3, h5, .creative-title-container *, .sub-text-under-banner {
            font-family: 'Fredoka', sans-serif; 
            font-weight: 700;
        }

        /* ğŸï¸ æ¨™é ­å€å¡Š (Header) */
        .page-header { 
            /* èª¿æ•´èƒŒæ™¯è‰²å’Œæ¼¸å±¤ï¼Œä½¿å…¶æ›´æ¥è¿‘åƒè€ƒåœ–çš„æŸ”å’Œæ„Ÿ */
            background: linear-gradient(135deg, #E0F7FA 0%, #A8DADC 100%); 
            padding: 50px 0; 
            margin-bottom: 30px; 
            border-bottom: none; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            min-height: 250px; 
            position: relative; 
            flex-direction: column; 
        }
        .page-header .container {
             display: flex;
             flex-direction: column; 
             align-items: center; 
             justify-content: center; 
             width: 100%; 
        }
        .page-header p.text-dark.fs-5 { 
            display: none;
        }

        /* ================================================= */
        /* ğŸ† å‰µæ„æ¨™é¡Œæ¨£å¼ (æ——å¹Ÿ) */
        /* ================================================= */
        .creative-title-container {
            display: inline-block;
            text-align: center;
            position: relative;
            padding-bottom: 0; 
            margin-bottom: 5px; 
            z-index: 10; 
        }
        .main-title-banner {
            background-color: var(--banner-main);
            color: var(--text-light);
            padding: 20px 50px; 
            font-size: 3rem; 
            line-height: 1.2;
            position: relative;
            z-index: 2; 
            clip-path: polygon(0 0, 5% 50%, 0 100%, 100% 100%, 95% 50%, 100% 0);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.25); 
        }
        .main-title-banner i {
            font-size: 2.5rem; 
            vertical-align: middle; 
            margin-right: 15px;
        }
        .main-title-banner::after {
            content: '';
            position: absolute;
            bottom: -5px; 
            left: 5%; 
            right: 5%; 
            height: 5px;
            background-color: var(--border-green);
            z-index: 3;
            clip-path: polygon(0 0, 100% 0, 97% 100%, 3% 100%); 
        }
        .sub-text-under-banner {
            color: var(--banner-sub-text-color); 
            font-size: 1.5rem;
            margin-top: 10px; 
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5); 
        }
        
        /* éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 992px) {
            .main-title-banner { font-size: 2.5rem; padding: 15px 30px; clip-path: polygon(0 0, 5% 50%, 0 100%, 95% 100%, 100% 50%, 95% 0); }
            .main-title-banner i { font-size: 2rem; margin-right: 10px; }
            .sub-text-under-banner { font-size: 1.2rem; margin-top: 8px; }
        }
        @media (max-width: 768px) {
            .main-title-banner { font-size: 2rem; padding: 12px 25px; }
            .main-title-banner i { font-size: 1.8rem; margin-right: 8px; }
            .sub-text-under-banner { font-size: 1rem; margin-top: 5px; }
        }

        /* â¡ï¸ è¿”å›åœ°åœ–æŒ‰éˆ• (åœ¨æ¨™é¡Œä¸‹æ–¹) */
        .page-header .btn-outline-primary {
            position: static; 
            margin-top: 20px !important; 
            transform: none; 
            width: auto;
            color: var(--button-border-green);
            border-color: var(--button-border-green);
            background-color: white; 
            padding: 12px 25px;
            font-weight: 600;
            border-radius: 10px; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
            transition: all 0.3s ease;
            z-index: 15; 
        }
        .page-header .btn-outline-primary:hover {
            background-color: var(--button-border-green);
            color: white;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            transform: scale(1.03); 
        }


        /* ğŸ“„ å…§å®¹å¡ç‰‡ (Form Card) */
        .content-card { 
            padding: 30px; 
            border-radius: 15px; 
            background-color: var(--form-bg);
            box-shadow: 0 10px 30px rgba(0, 168, 232, 0.2); 
            min-height: 400px; 
        }
        .content-card h3 {
            color: var(--primary-color);
            border-bottom: 3px dashed var(--bg-light);
            padding-bottom: 10px;
        }

        /* ğŸ“‹ è¡¨å–®å€å¡Š */
        .border.rounded.bg-light {
            background-color: var(--section-bg) !important; 
            border: 1px solid #BEE3F8 !important; 
            border-radius: 10px !important;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        .text-secondary {
            color: var(--secondary-color) !important; 
        }
        .form-label {
            font-weight: 600 !important;
        }

        /* ğŸŒŸ æäº¤æŒ‰éˆ• */
        .btn-primary.btn-lg {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            font-weight: 700;
            letter-spacing: 1px;
            padding: 15px 0;
            transition: background-color 0.3s ease, transform 0.1s ease;
        }
        .btn-primary.btn-lg:hover {
            background-color: #008EC9; 
            border-color: #008EC9;
            transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(0, 168, 232, 0.4); 
        }

        /* ğŸ¦¶ é å°¾ */
        .bg-dark {
            background-color: #0D47A1 !important; 
            color: #fff !important;
        }

        /* åœ°åœ–å®¹å™¨æ¨£å¼ (æ–°å¢) */
        #mapid {
            height: 300px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        /* é‡å°åœ°åœ–æ–‡å­—æ¬„ä½è¨­ç‚ºåªè®€çš„æ¨£å¼ */
        .form-control[readonly] {
            background-color: #e9ecef;
            cursor: default;
        }
    </style>
</head>
<body>

    <div class="container-fluid page-header">
        <div class="container text-center">
            
            <div class="creative-title-container">
                <div class="main-title-banner">
                    <i class="bi bi-person-bounding-box"></i>æ¯›å­©æª”æ¡ˆå»ºç«‹
                </div>
            </div>
            
            <div class="sub-text-under-banner">ä¸Šå‚³æ‚¨çš„æ¯›å­©èˆ‡åœ°é»</div>
            
            <a href="{{ url_for('show_main_map') }}" class="btn btn-outline-primary btn-sm">
                <i class="bi bi-map me-2"></i>è¿”å›åœ°åœ–é¦–é 
            </a>
            
        </div>
    </div>

    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="rounded content-card">
                    <h3 class="mb-4 text-primary"><i class="bi bi-file-earmark-person me-2"></i>å¡«å¯«äº¤å‹è³‡è¨Š</h3>
                    <p class="mb-4 text-muted">è«‹å¡«å¯«ä»¥ä¸‹è³‡è¨Šï¼Œè®“æ‚¨çš„æ¯›å­©é€²å…¥äº¤å‹åœ°åœ–ï¼Œä¸€èµ·ä¾†çµäº¤æ–°æœ‹å‹å§ï¼</p>
                    
                    <form action="{{ url_for('handle_upload') }}" method="POST" enctype="multipart/form-data"> 
                        
                        <div class="row mb-4 p-4 border rounded bg-light">
                            <h5 class="text-secondary mb-3">å€å¡Šä¸€ï¼šåŸºæœ¬æª”æ¡ˆ</h5>
                            
                            <div class="col-md-4 mb-3">
                                <label for="petImage" class="form-label fw-bold">1. æ¯›å­©ç…§ç‰‡ *</label>
                                <input class="form-control" type="file" id="petImage" name="petImage" accept="image/*" required>
                                <div class="form-text">ä¸Šå‚³ä¸€å¼µå¯æ„›çš„æ­£é¢æ¸…æ™°ç…§ã€‚</div>
                            </div>
                            
                            <div class="col-md-8">
                                <div class="row">
                                    <div class="col-12 mb-3">
                                        <label for="petName" class="form-label">2. åå­— *</label>
                                        <input type="text" class="form-control" id="petName" name="petName" placeholder="ä¾‹å¦‚ï¼šæ¨‚æ¨‚ (Lele)" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="petSpecies" class="form-label">3. ç‰©ç¨® *</label>
                                        <select class="form-select" id="petSpecies" name="petSpecies" required>
                                            <option value="">è«‹é¸æ“‡</option>
                                            <option value="dog">ç‹— (Dog)</option>
                                            <option value="cat">è²“ (Cat)</option>
                                            <option value="other">å…¶ä»–</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="petAge" class="form-label">4. å¹´é½¡ (æ­²) *</label>
                                        <input type="number" class="form-control" id="petAge" name="petAge" min="0" max="30" required>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4 p-4 border rounded">
                            <h5 class="text-secondary mb-3">å€å¡ŠäºŒï¼šå€‹æ€§èˆ‡è¡Œç‚ºæ¨™ç±¤</h5>
                            <label class="form-label fw-bold mb-2">5. å€‹æ€§æ¨™ç±¤ (å¯è¤‡é¸)</label>
                            <div class="row">
                                <div class="col-6 col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="active" id="tagActive" name="tags">
                                        <label class="form-check-label" for="tagActive">ğŸƒ æ´»æ½‘å¥½å‹•</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="shy" id="tagShy" name="tags">
                                        <label class="form-check-label" for="tagShy">ğŸ˜Œ æ…¢ç†Ÿæ€•ç”Ÿ</label>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="dogFriendly" id="tagDogFriendly" name="tags">
                                        <label class="form-check-label" for="tagDogFriendly">ğŸ• å°ç‹—å‹å–„</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="catFriendly" id="tagCatFriendly" name="tags">
                                        <label class="form-check-label" for="tagCatFriendly">ğŸˆ å°è²“å‹å–„</label>
                                    </div>
                                </div>
                                
                                <div class="col-6 col-md-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="other" id="tagOther" name="tags" onchange="toggleOtherTagsInput()">
                                        <label class="form-check-label" for="tagOther">â• å…¶ä»– (è«‹è¼¸å…¥)</label>
                                    </div>
                                </div>
                                
                                <div class="col-12 mt-3" id="otherTagsInputContainer" style="display: none;">
                                    <label for="otherTagsText" class="form-label small">è«‹è¼¸å…¥å…¶ä»–å€‹æ€§æ¨™ç±¤ (ä»¥é€—è™Ÿåˆ†éš”)</label>
                                    <input type="text" class="form-control form-control-sm" id="otherTagsText" name="otherTagsText" placeholder="ä¾‹å¦‚ï¼šæ„›åƒé›¶é£Ÿ, æ€•æ°´, å–œæ­¡ç©çƒ">
                                </div>
                                
                                <div class="col-12 mt-3">
                                    <div class="form-text">é€™äº›æ¨™ç±¤æœ‰åŠ©æ–¼å…¶ä»–é£¼ä¸»äº†è§£æ‚¨çš„æ¯›å­©æ˜¯å¦é©åˆä¸€èµ·ç©ã€‚</div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4 p-4 border rounded bg-light">
                            <h5 class="text-secondary mb-3">å€å¡Šä¸‰ï¼šæ´»å‹•åœ°é»</h5>
                            
                            <div id="mapid"></div>

                            <div class="mb-3">
                                <label for="location" class="form-label fw-bold">6. æœ€å¸¸æ´»å‹•åœ°é» (é»æ“Šåœ°åœ–æ¨™è¨˜) *</label>
                                <input type="text" class="form-control" id="location" name="location" placeholder="è«‹åœ¨åœ°åœ–ä¸Šé»æ“Šæˆ–æ‹–æ›³æ¨™è¨˜ï¼Œä»¥ç¢ºå®šåœ°é»" required readonly>
                                <div class="form-text">è«‹åœ¨åœ°åœ–ä¸Šç²¾ç¢ºé»æ“Šæ‚¨çš„æ¯›å­©å¸¸å‡ºæ²’çš„åœ°é»ï¼Œåœ°åœ–æ¨™è¨˜å°‡è‡ªå‹•æŠ“å–ç¶“ç·¯åº¦ã€‚</div>
                            </div>

                            <input type="hidden" id="lat" name="lat" required>
                            <input type="hidden" id="lon" name="lon" required>
                            
                            <div class="mb-3">
                                <label for="interactionNote" class="form-label fw-bold">7. äº’å‹•å‚™è¨»</label>
                                <textarea class="form-control" id="interactionNote" name="interactionNote" rows="3" placeholder="ä¾‹å¦‚ï¼šå–œæ­¡è¢«æ‘¸è€³æœµï¼›çœ‹åˆ°è‡ªè¡Œè»Šæœƒèˆˆå¥®åœ°å«ï¼›ä¸å–œæ­¡è¢«æ‘¸å°¾å·´ã€‚"></textarea>
                                <div class="form-text">è«‹æä¾›é‡è¦çš„äº’å‹•æç¤ºï¼Œç¢ºä¿å®‰å…¨èˆ‡æ„‰å¿«çš„é«”é©—ã€‚</div>
                            </div>
                        </div>

                        <div class="mb-4 p-4 border rounded bg-light">
                            <h5 class="text-secondary mb-3">å€å¡Šå››ï¼šå°ˆæ¥­é†«ç™‚ç´€éŒ„</h5>
    
                            <div class="mb-3">
                                <label for="medicalRecord" class="form-label fw-bold">8. é†«ç™‚ç´€éŒ„æ–‡ä»¶ (éå¿…å¡«)</label>
                                <input class="form-control" type="file" id="medicalRecord" name="medicalRecord" accept=".pdf,image/*,.doc,.docx" multiple>
                            <div class="form-text">å¯ä¸Šå‚³ç–«è‹—æ‰‹å†Šã€å¥åº·æª¢æŸ¥å ±å‘Šæˆ–éæ•ç´€éŒ„ç­‰ï¼Œæ ¼å¼æ”¯æ´åœ–ç‰‡/PDF/Wordã€‚</div>
                        </div>
    
                        <div class="mb-3">
                            <label for="healthNote" class="form-label fw-bold">9. ç°¡è¦å¥åº·ç‹€æ³å‚™è¨»</label>
                            <textarea class="form-control" id="healthNote" name="healthNote" rows="2" placeholder="ä¾‹å¦‚ï¼šå·²çµç´®ï¼›å°èŠ±ç”Ÿéæ•ï¼›æœ‰è¼•å¾®é—œç¯€ç‚ï¼Œä¸å®œæ¿€çƒˆè·‘è·³ã€‚"></textarea>
                            <div class="form-text">å…¬é–‹é¡¯ç¤ºçš„ç°¡è¦å¥åº·è³‡è¨Šï¼Œå¢åŠ äº’å‹•å®‰å…¨æ€§ã€‚</div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-lg w-100 mt-4">
                            <i class="bi bi-rocket-takeoff-fill me-2"></i>æäº¤æª”æ¡ˆä¸¦åŠ å…¥åœ°åœ–ï¼
                        </button>
                        
                    </form> 
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid py-3 mt-auto bg-dark">
        <div class="container text-center">
            <p class="mb-0 small">&copy; ğŸ¾ æ¯›å­©äº¤å‹åŸºåœ°. All Rights Reserved.</p>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    
    <script>
        // --- å€å¡ŠäºŒï¼šå…¶ä»–æ¨™ç±¤æ§åˆ¶ ---
        function toggleOtherTagsInput() {
            const otherCheckbox = document.getElementById('tagOther');
            const otherInputContainer = document.getElementById('otherTagsInputContainer');
            
            if (otherCheckbox.checked) {
                otherInputContainer.style.display = 'block';
            } else {
                otherInputContainer.style.display = 'none';
                document.getElementById('otherTagsText').value = ''; 
            }
        }

        // --- å€å¡Šä¸‰ï¼šåœ°åœ–é»æ“Šæ§åˆ¶ ---
        
        // é è¨­ä¸­å¿ƒï¼šå°åŒ—å¸‚ä¸­å¿ƒ (ç¶“ç·¯åº¦)
        const initialLat = 25.0330; 
        const initialLon = 121.5654; 

        // åˆå§‹åŒ–åœ°åœ–ä¸¦è¨­å®šè¦–åœ–ä¸­å¿ƒ
        const map = L.map('mapid').setView([initialLat, initialLon], 13);

        // ä½¿ç”¨ OpenStreetMap åœ–å±¤
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // åˆå§‹åŒ–ä¸€å€‹å¯æ‹–æ›³çš„æ¨™è¨˜
        let marker = L.marker([initialLat, initialLon], {
            draggable: true
        }).addTo(map);

        // é å…ˆå¡«å……ç¶“ç·¯åº¦ï¼Œä»¥æ»¿è¶³è¡¨å–® required å±¬æ€§
        document.getElementById('lat').value = initialLat.toFixed(6);
        document.getElementById('lon').value = initialLon.toFixed(6);
        document.getElementById('location').value = "åˆå§‹é è¨­ä½ç½®ï¼šå°åŒ—å¸‚ä¸­å¿ƒ";


        function updateLocationFields(lat, lon) {
            // æ›´æ–°éš±è—çš„ç¶“ç·¯åº¦æ¬„ä½
            document.getElementById('lat').value = lat.toFixed(6);
            document.getElementById('lon').value = lon.toFixed(6);
            
            // æ›´æ–°åœ°åœ–ä¸‹æ–¹çš„æ–‡å­—é¡¯ç¤º
            document.getElementById('location').value = `å·²é¸å®šï¼šç·¯åº¦ ${lat.toFixed(4)}, ç¶“åº¦ ${lon.toFixed(4)} (é»æ“Šæˆ–æ‹–æ›³è®Šæ›´)`;
        }

        // 1. è™•ç†åœ°åœ–é»æ“Šäº‹ä»¶
        map.on('click', function(e) {
            const { lat, lng } = e.latlng;
            
            // ç§»å‹•æ¨™è¨˜åˆ°é»æ“Šçš„ä½ç½®
            marker.setLatLng([lat, lng]);
            
            updateLocationFields(lat, lng);
        });

        // 2. è™•ç†æ¨™è¨˜æ‹–æ›³çµæŸäº‹ä»¶
        marker.on('dragend', function(e) {
            const { lat, lng } = e.target.getLatLng();
            updateLocationFields(lat, lng);
        });
    </script>
</body>
</html>